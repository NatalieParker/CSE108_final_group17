{% extends "base.html" %}
{% block title %}CSE 108 Final: {{ show.title }}{% endblock %}
{% block body %}

<div class="hero"> 

    <img
      class="cover"
      src="{{ show.cover or url_for('static', filename='covers/default.jpg') }}"
      alt="{{ show.title }} cover"
    >
  </div>

<div class="panel">

  <h1>{{ show.title }}</h1>

  <section>
    <p><strong>Director:</strong> {{ show.director or "N/A" }}</p>
    <p><strong>Cast:</strong> {{ show.cast or "N/A" }}</p>
    <p><strong>Release Year:</strong> {{ show.release_year or "N/A" }}</p>
    <p><strong>Rating:</strong> {{ show.rating or "N/A" }}</p>
    <p><strong>Seasons:</strong> {{ show.seasons or "N/A" }}</p>
    <p><strong>Genres:</strong> {{ show.genres or "N/A" }}</p>
    <p><strong>Description:</strong></p>
    <p>{{ show.description or "No description available." }}</p>
  </section>
</div>
</div>

  <hr>

  <section class = "panel">
    <h2>Episodes</h2>

    {% if episodes %}
      <ul
        id="episodeList"
        data-show-id="{{ show.id }}"
        data-max-watched="{{ maxWatchedEpisode or 0 }}"
      >
        {% for ep in episodes %}
          <li
            class="episode-item"
            data-episode-id="{{ ep.id }}"
            data-episode-number="{{ ep.episode_number }}"
          >
            Episode {{ ep.episode_number }}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No episodes available.</p>
    {% endif %}
  </section>

  <hr>
  <section>
        <h2>Write a Review</h2>

  {% if current_user.is_authenticated %}
    <form method="POST" action="{{ url_for('add_review', show_id=show.id) }}">
        <label for="episode_numbers"><strong>Select episode(s) (optional)</strong></label><br>
        <select id="episode_numbers" name="episode_numbers" multiple size="6">
            {% for ep in episodes %}
            <option value="{{ ep.episode_number }}">Episode {{ ep.episode_number }}</option>
            {% endfor %}
        </select>
        <p style="font-size: 0.9em; margin-top: 6px;">
        Hold <strong>Cmd</strong> (Mac) or <strong>Ctrl</strong> (Windows) to select multiple.
        </p>


      <br><br>

      <label for="rating"><strong>Rating (1â€“5)</strong></label><br>
      <input id="rating" name="rating" type="number" min="1" max="5" required>

      <br><br>

      <label for="review_text"><strong>Review</strong></label><br>
      <textarea id="review_text" name="review_text" rows="4" cols="60" required></textarea>

      <br><br>

      <button type="submit">Submit Review</button>
    </form>
  {% else %}
    <p><a href="{{ url_for('auth.login') }}">Sign in</a> to write a review.</p>
  {% endif %}

  </section>

  <hr>

  <section>
    <h2>Reviews</h2>

    {% if reviews %}
      {% for review, username, rating, text in reviews %}
        <div class="review">
          <p>
            <strong>{{ username }}</strong>
            rated it <strong>{{ rating }}/5</strong>
          </p>
          <p>{{ text }}</p>
        </div>
        <hr>
      {% endfor %}
    {% else %}
      <p>No reviews yet.</p>
    {% endif %}
  </section>

{% endblock %}
